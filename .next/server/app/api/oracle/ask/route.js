"use strict";(()=>{var e={};e.id=7316,e.ids=[7316],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},31950:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>f,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>g,staticGenerationAsyncStorage:()=>x});var r={};a.r(r),a.d(r,{POST:()=>d,dynamic:()=>p,runtime:()=>c});var s=a(49303),o=a(88716),n=a(60670),i=a(87070);let c="nodejs",p="force-dynamic";function u(e){return e.replace(/\b\d{3}\.\d{3}\.\d{3}-\d{2}\b/g,"[CPF]").replace(/\b\d{2}\.\d{3}\.\d{3}\/\d{4}-\d{2}\b/g,"[CNPJ]").replace(/\b[\w.-]+@[\w.-]+\.[A-Za-z]{2,}\b/g,"[EMAIL]").replace(/\b\+?\d{2,3}\s?\d{4,5}-\d{4}\b/g,"[PHONE]")}async function d(e){try{let t=await e.json();if("false"===process.env.ORACLE_ENABLED)return i.NextResponse.json({insights:[],narrative:"Or\xe1culo desativado",actions:[],confidence:0});let a=process.env.OPENAI_API_KEY,r=process.env.ORACLE_MODEL||"gpt-4o-mini",s=Number(process.env.ORACLE_TIMEOUT||2e4);if(!a)return i.NextResponse.json({error:"OPENAI_API_KEY ausente"},{status:400});let{area:o,filters:n,kpis:c,sampleRows:p,metadata:d,mode:l,question:m}=t||{},x=Array.isArray(p)?p.slice(0,50).map(e=>JSON.stringify(e)).map(u):[],g=`Voc\xea \xe9 um or\xe1culo de dados especializado na \xe1rea: ${o}.
Filtros atuais: ${JSON.stringify(n)}
KPIs: ${JSON.stringify(c)}
Metadados: ${JSON.stringify(d)}
Amostra (mascarada):
${x.join("\n")}

Modo: ${l}. ${m?`Pergunta: ${m}`:""}
Responda com insights objetivos, narrativa executiva e a\xe7\xf5es pr\xe1ticas com impacto/risco/esfor\xe7o.`,f=new AbortController,v=setTimeout(()=>f.abort(),s),h=await fetch("https://api.openai.com/v1/responses",{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({model:r,input:g}),signal:f.signal}).catch(e=>({ok:!1,status:500,statusText:String(e)}));if(clearTimeout(v),!h.ok)return i.NextResponse.json({error:`Falha Or\xe1culo: ${h.status} ${h.statusText}`},{status:500});let A=await h.json(),O=A.output?.[0]?.content?.[0]?.text||A.content?.[0]?.text||"";return i.NextResponse.json({insights:[],narrative:O,actions:[],confidence:.7})}catch(e){return i.NextResponse.json({error:e?.message??String(e)},{status:500})}}let l=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/oracle/ask/route",pathname:"/api/oracle/ask",filename:"route",bundlePath:"app/api/oracle/ask/route"},resolvedPagePath:"/Users/alceualvespasssosmac/cepalab/app/api/oracle/ask/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:x,serverHooks:g}=l,f="/api/oracle/ask/route";function v(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:x})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[9276,5972],()=>a(31950));module.exports=r})();